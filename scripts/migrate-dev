# use prisma migrate to create SQL migrations file

dir="$( cd "$( dirname "$0" )" && pwd )"
container_name="prisma-shadow-db-pg"

echo "### Migrate the database ###"
if ! docker ps --format "{{.Names}}" | grep -q "${container_name}"; then
    echo "creating a migration database in docker.."
    . "${dir}/docker-shadow-db.sh"
    else
    echo "migration database exists."
fi


echo "running the migration.."
yarn clear-db && \
yarn dotenv -e ../../.env.development -- \
yarn prisma migrate dev
echo "command exit with code $?"
echo "Warning!! If you're migration is already sync, please seed your dev database manually."
echo ""