FROM --platform=linux/amd64 node:18-alpine3.18 as install
WORKDIR /root
COPY package.json ./
COPY yarn.lock ./
COPY .yarn .yarn
COPY . .
RUN yarn --immutable --inline-builds

FROM --platform=linux/amd64 node:18-alpine3.18 as node_modules
COPY --from=install /root/node_modules ./node_modules
COPY --from=install /root/.yarn ./.yarn