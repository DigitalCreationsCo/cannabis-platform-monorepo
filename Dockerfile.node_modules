FROM --platform=linux/amd64 node:18-alpine3.19 as install
WORKDIR /root
COPY package.json ./
COPY yarn.lock ./
COPY .yarn .yarn
COPY . .

# RUN yarn install --immutable # immutable install is failing with code 1
RUN yarn install

FROM --platform=linux/amd64 node:18-alpine3.19 as node_modules
COPY --from=install /root/node_modules ./node_modules
COPY --from=install /root/.yarn ./.yarn