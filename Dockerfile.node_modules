FROM --platform=linux/amd64 node:18-alpine3.19 as install
WORKDIR /root
COPY package.json ./
COPY yarn.lock ./
COPY .yarn .yarn
COPY . .

RUN npx envinfo --binaries --system
RUN npm install --verbose sharp # test output of sharp install
RUN yarn --immutable

FROM --platform=linux/amd64 node:18-alpine3.19 as node_modules
COPY --from=install /root/node_modules ./node_modules
COPY --from=install /root/.yarn ./.yarn