generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl", "debian-openssl-1.1.x"]
}

datasource db {
  provider          = "postgresql"
  url               = env("POOLING_DATABASE_URL")
  directUrl         = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Account {
  id                 String   @id @unique @default(cuid())
  userId             String?
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?
  access_token       String?
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?
  oauth_token_secret String?
  oauth_token        String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id            String   @id @unique @default(cuid())
  sessionHandle String   @unique
  email         String
  username      String
  expires       DateTime
  userId        String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionHandle])
}

model User {
  id               String       @id @unique @default(cuid())
  firstName        String
  lastName         String
  username         String       @unique
  email            String       @unique
  emailVerified    Boolean      @default(false)
  isLegalAge       Boolean?
  isSignUpComplete Boolean      @default(false)
  termsAccepted    Boolean      @default(false)
  idVerified       Boolean      @default(false)
  scannedDOB       DateTime?
  idFrontImage     String?
  idBackImage      String?
  dialCode         String
  phone            String       @unique
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  accounts         Account[]
  driver           Driver?
  profilePicture   ImageUser?
  memberships      Membership[]
  orders           Order[]
  reviews          Review[]
  sessions         Session[]
  address          Address[]    @relation("AddressToUser")

  @@index([id])
  @@index([email])
  @@index([phone])
}

model Driver {
  id            String         @id @default(cuid())
  email         String         @unique
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  user          User           @relation(fields: [id], references: [id])
  driverSession DriverSession?
  orders        Order[]
  routes        Route[]

  @@index([id])
  @@index([email])
}

model DriverSession {
  id               String   @id @unique @default(cuid())
  isOnline         Boolean  @default(false)
  isActiveDelivery Boolean  @default(false)
  routeId          String?  @unique
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  driver           Driver   @relation(fields: [id], references: [id])

  @@index([id])
  @@index([routeId])
}

model Route {
  driverId String
  orderId  String @unique
  driver   Driver @relation(fields: [driverId], references: [id], onDelete: NoAction)
  order    Order  @relation(fields: [orderId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([driverId])
  @@index([orderId])
}

model Vendor {
  id            String         @id @unique @default(cuid())
  name          String         @unique
  publicName    String         @unique
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  organizations Organization[]

  @@unique([id, name])
  @@index([id])
  @@index([name])
  @@index([publicName])
}

model Address {
  id           String        @id @unique @default(cuid())
  street1      String
  street2      String?
  city         String
  state        String
  zipcode      Int
  country      String
  countryCode  String?
  coordinateId String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  coordinates  Coordinates?  @relation(fields: [coordinateId], references: [id], onDelete: Cascade, onUpdate: SetNull)
  orders       Order[]
  organization Organization?
  user         User[]        @relation("AddressToUser")

  @@index([id])
}

model ImageOrganization {
  id             String       @id @unique @default(cuid())
  location       String
  organizationId String
  blurhash       String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model ImageProduct {
  id        String         @id @unique @default(cuid())
  location  String
  variantId String
  blurhash  String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  variant   ProductVariant @relation("images", fields: [variantId], references: [id])

  @@index([variantId])
}

model ImageUser {
  id        String   @id @unique @default(cuid())
  location  String
  userId    String   @unique
  blurhash  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model ImageVendor {
  id        String   @id @unique @default(cuid())
  location  String
  blurhash  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([id])
}

model ImageArticle {
  id        String   @id @unique @default(cuid())
  location  String
  articleId String   @unique
  blurhash  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
}

model Coordinates {
  id        String    @id @unique @default(cuid())
  latitude  Float
  longitude Float
  radius    Float?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  addresses Address[]
}

model Membership {
  id             String         @id @unique @default(cuid())
  role           MembershipRole
  organizationId String
  userId         String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  user           User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
  organizations  Organization[] @relation("MembershipToOrganization")

  @@unique([id, organizationId])
  @@index([userId])
}

model Order {
  id                      String           @id @unique @default(cuid())
  subtotal                Int
  total                   Int
  taxFactor               Float
  taxAmount               Int
  orderStatus             OrderStatus      @default(Pending)
  purchaseId              String?          @unique
  addressId               String
  customerId              String
  organizationId          String
  driverId                String?
  createdAt               DateTime         @default(now())
  updatedAt               DateTime         @updatedAt
  isDriverAssigned        Boolean          @default(false)
  driverAssignedAt        DateTime?
  isProductPickedUp       Boolean          @default(false)
  productPickedUpAt       DateTime?
  isDeliveredOrder        Boolean          @default(false)
  deliveredAt             DateTime?
  isCustomerReceivedOrder Boolean          @default(false)
  customerReceivedOrderAt DateTime?
  isCompleted             Boolean          @default(false)
  completedAt             DateTime?
  routeId                 String?          @unique
  destinationAddress      Address          @relation(fields: [addressId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  customer                User             @relation(fields: [customerId], references: [id], onDelete: NoAction)
  driver                  Driver?          @relation(fields: [driverId], references: [id])
  organization            Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  purchase                Purchase?
  route                   Route?
  items                   ProductVariant[] @relation("OrderToProductVariant")

  @@index([addressId])
  @@index([customerId])
  @@index([driverId])
  @@index([organizationId])
}

model Purchase {
  id            String        @id @unique @default(cuid())
  paymentStatus PaymentStatus @default(Pending)
  gateway       String        @default("stripe")
  type          String        @default("card")
  amount        Float
  token         String
  orderId       String        @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  order         Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
}

model Organization {
  id                       String              @id @unique @default(cuid())
  name                     String              @unique
  stripeAccountId          String?             @unique
  stripeOnboardingComplete Boolean             @default(false)
  addressId                String              @unique
  dialCode                 String
  phone                    String?
  vendorId                 String
  vendorName               String
  scheduleId               String              @unique
  termsAccepted            Boolean             @default(false)
  subdomainId              String
  createdAt                DateTime            @default(now())
  updatedAt                DateTime            @updatedAt
  categoryList             CategoryList?
  images                   ImageOrganization[]
  orders                   Order[]
  address                  Address             @relation(fields: [addressId], references: [id], onDelete: Cascade)
  schedule                 Schedule            @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  subdomain                SubDomain           @relation(fields: [subdomainId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  vendor                   Vendor              @relation(fields: [vendorId, vendorName], references: [id, name])
  products                 Product[]
  siteSetting              SiteSetting?
  memberships              Membership[]        @relation("MembershipToOrganization")

  @@index([id])
  @@index([name])
  @@index([vendorId])
  @@index([subdomainId])
}

model Schedule {
  id           String        @id @unique @default(cuid())
  days         Int
  openAt       Int?
  closeAt      Int?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  organization Organization?

  @@index([id])
}

model Product {
  id             String           @id @unique @default(cuid())
  name           String
  description    String?
  features       String?
  organizationId String
  rating         Float
  tags           String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  variants       ProductVariant[]
  reviews        Review?
  categories     Category[]       @relation("CategoryToProduct")

  @@index([id])
  @@index([organizationId])
}

model ProductVariant {
  id               String         @id @unique @default(cuid())
  name             String
  sku              Float?
  organizationId   String
  organizationName String
  productId        String
  rating           Float
  unit             Unit           @default(g)
  size             Float
  quantity         Int
  basePrice        Int
  discount         Int
  isDiscount       Boolean
  salePrice        Int
  currency         CurrencyName
  stock            Int
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  images           ImageProduct[] @relation("images")
  product          Product        @relation(fields: [productId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order            Order[]        @relation("OrderToProductVariant")

  @@index([id])
  @@index([productId])
}

model Category {
  id            String              @id @unique @default(cuid())
  name          String
  slug          String
  icon          String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  categoryLists ProductCategories[]
  products      Product[]           @relation("CategoryToProduct")

  @@index([name])
}

model ProductCategories {
  categoryListId String
  categoryId     String
  category       Category     @relation(fields: [categoryId], references: [id])
  categoryList   CategoryList @relation(fields: [categoryListId], references: [id])

  @@id([categoryListId, categoryId])
  @@index([categoryListId])
  @@index([categoryId])
}

model CategoryList {
  id             String              @id @unique @default(cuid())
  organizationId String              @unique
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  categories     ProductCategories[]
}

model ServiceList {
  id        String    @id @unique @default(cuid())
  name      String
  slug      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  services  Service[] @relation("ServiceToServiceList")

  @@index([slug])
}

model Service {
  id           String        @id @unique @default(cuid())
  title        String
  subtitle     String?
  slug         String        @unique
  icon         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  serviceLists ServiceList[] @relation("ServiceToServiceList")

  @@index([title])
  @@index([slug])
}

model Review {
  id        String   @id @unique @default(cuid())
  rating    Float
  comment   String?
  productId String   @unique
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([productId])
}

model SiteSetting {
  id             String       @id @unique @default(cuid())
  description    String?
  title          String
  bannerText     String?
  organizationId String       @unique
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([id])
}

model SubDomain {
  id           String         @id @unique @default(cuid())
  isValid      Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  organization Organization[]

  @@index([id])
}

model Article {
  id          String        @id @unique @default(cuid())
  name        String
  title       String
  description String
  href        String
  tag         ArticleType
  content     String
  author      String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  image       ImageArticle?

  @@index([id])
  @@index([title])
}

model all_auth_recipe_users {
  user_id     String @id @db.Char(36)
  recipe_id   String @db.VarChar(128)
  time_joined BigInt

  @@index([time_joined(sort: Desc), user_id(sort: Desc)], map: "all_auth_recipe_users_pagination_index")
}

model emailpassword_pswd_reset_tokens {
  user_id             String              @db.Char(36)
  token               String              @unique @db.VarChar(128)
  token_expiry        BigInt
  emailpassword_users emailpassword_users @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@id([user_id, token])
  @@index([token_expiry], map: "emailpassword_password_reset_token_expiry_index")
}

model emailpassword_users {
  user_id                         String                            @id @db.Char(36)
  email                           String                            @unique @db.VarChar(256)
  password_hash                   String                            @db.VarChar(128)
  time_joined                     BigInt
  emailpassword_pswd_reset_tokens emailpassword_pswd_reset_tokens[]
}

model emailverification_tokens {
  user_id      String @db.VarChar(128)
  email        String @db.VarChar(256)
  token        String @unique @db.VarChar(128)
  token_expiry BigInt

  @@id([user_id, email, token])
  @@index([token_expiry], map: "emailverification_tokens_index")
}

model emailverification_verified_emails {
  user_id String @db.VarChar(128)
  email   String @db.VarChar(256)

  @@id([user_id, email])
}

model jwt_signing_keys {
  key_id     String  @id @db.VarChar(255)
  key_string String
  algorithm  String  @db.VarChar(10)
  created_at BigInt?
}

model key_value {
  name            String  @id @db.VarChar(128)
  value           String?
  created_at_time BigInt?
}

model passwordless_codes {
  code_id              String               @id @db.Char(36)
  device_id_hash       String               @db.Char(44)
  link_code_hash       String               @unique @db.Char(44)
  created_at           BigInt
  passwordless_devices passwordless_devices @relation(fields: [device_id_hash], references: [device_id_hash], onDelete: Cascade)

  @@index([created_at], map: "passwordless_codes_created_at_index")
  @@index([device_id_hash], map: "passwordless_codes_device_id_hash_index")
}

model passwordless_devices {
  device_id_hash     String               @id @db.Char(44)
  email              String?              @db.VarChar(256)
  phone_number       String?              @db.VarChar(256)
  link_code_salt     String               @db.Char(44)
  failed_attempts    Int
  passwordless_codes passwordless_codes[]

  @@index([email], map: "passwordless_devices_email_index")
  @@index([phone_number], map: "passwordless_devices_phone_number_index")
}

model passwordless_users {
  user_id      String  @id @db.Char(36)
  email        String? @unique @db.VarChar(256)
  phone_number String? @unique @db.VarChar(256)
  time_joined  BigInt
}

model role_permissions {
  role       String @db.VarChar(255)
  permission String @db.VarChar(255)
  roles      roles  @relation(fields: [role], references: [role], onDelete: Cascade, onUpdate: NoAction)

  @@id([role, permission])
  @@index([permission], map: "role_permissions_permission_index")
}

model roles {
  role             String             @id @db.VarChar(255)
  role_permissions role_permissions[]
  user_roles       user_roles[]
}

model session_access_token_signing_keys {
  created_at_time BigInt  @id
  value           String?
}

model session_info {
  session_handle       String  @id @db.VarChar(255)
  user_id              String  @db.VarChar(128)
  refresh_token_hash_2 String  @db.VarChar(128)
  session_data         String?
  expires_at           BigInt
  created_at_time      BigInt
  jwt_user_payload     String?
}

model thirdparty_users {
  third_party_id      String @db.VarChar(28)
  third_party_user_id String @db.VarChar(128)
  user_id             String @unique @db.Char(36)
  email               String @db.VarChar(256)
  time_joined         BigInt

  @@id([third_party_id, third_party_user_id])
}

model user_metadata {
  user_id       String @id @db.VarChar(128)
  user_metadata String
}

model user_roles {
  user_id String @db.VarChar(128)
  role    String @db.VarChar(255)
  roles   roles  @relation(fields: [role], references: [role], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, role])
  @@index([role], map: "user_roles_role_index")
}

enum OrderStatus {
  Pending
  Processing
  OnDelivery
  Delivered
  Cancelled
}

enum PaymentStatus {
  Pending
  Paid
  Failed
}

enum MembershipRole {
  OWNER  @map("1")
  ADMIN  @map("2")
  MEMBER @map("3")
}

enum CurrencyName {
  USD
}

enum Unit {
  g
}

enum Day {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum ArticleType {
  dispensary
  driver
  news
}
