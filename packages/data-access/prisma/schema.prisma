generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl", "debian-openssl-1.1.x", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider          = "postgresql"
  url               = env("POOLING_DATABASE_URL")
  directUrl         = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Account {
  id                 String   @id @unique @default(cuid())
  userId             String?
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?
  access_token       String?
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?
  oauth_token_secret String?
  oauth_token        String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id            String   @id @unique @default(cuid())
  sessionHandle String   @unique
  email         String
  username      String
  expires       DateTime
  userId        String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionHandle])
}

model Compliance {
  id               String       @id @unique @default(cuid())
  state            USStateAbbreviated       @unique
  license          LicenseGuidelines? @relation("LicenseGuidelines")
  transport        TransportGuidelines? @relation("TransportGuidelines")
  sale             SaleGuidelines? @relation("SaleGuidelines")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model LicenseGuidelines {
  state            USStateAbbreviated          @unique
  compliance       Compliance @relation("LicenseGuidelines", fields: [state], references: [state], onDelete: Cascade, onUpdate: Cascade)
  licenseType      LicenseType[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model TransportGuidelines {
  state            USStateAbbreviated          @unique
  compliance       Compliance @relation("TransportGuidelines", fields: [state], references: [state], onDelete: Cascade, onUpdate: Cascade)
  transportWeightLimit      Float
  transportStartTime        Int
  transportEndTime          Int
  transportLockedStorage    Boolean
  transportManifest         Boolean
  transportStaff            Int
  medicalDelivery           Boolean
  recreationalDelivery      Boolean

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model SaleGuidelines {
  state            USStateAbbreviated          @unique
  compliance       Compliance @relation("SaleGuidelines", fields: [state], references: [state], onDelete: Cascade, onUpdate: Cascade)
  medicalSales     Boolean
  recreationalSales Boolean
  ageLimit         Int
  thcLimit         Int
  weightLimit      Float

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

enum LicenseType {
  dispensary
  delivery
}

enum USState {
    ALABAMA
    ALASKA
    ARIZONA
    ARKANSAS
    CALIFORNIA
    COLORADO
    CONNECTICUT
    DELAWARE
    FLORIDA
    GEORGIA
    HAWAII
    IDAHO
    ILLINOIS
    INDIANA
    IOWA
    KANSAS
    KENTUCKY
    LOUISIANA
    MAINE
    MARYLAND
    MASSACHUSETTS
    MICHIGAN
    MINNESOTA
    MISSISSIPPI
    MISSOURI
    MONTANA
    NEBRASKA
    NEVADA
    NEW_HAMPSHIRE
    NEW_JERSEY
    NEW_MEXICO
    NEW_YORK
    NORTH_CAROLINA
    NORTH_DAKOTA
    OHIO
    OKLAHOMA
    OREGON
    PENNSYLVANIA
    RHODE_ISLAND
    SOUTH_CAROLINA
    SOUTH_DAKOTA
    TENNESSEE
    TEXAS
    UTAH
    VERMONT
    VIRGINIA
    WASHINGTON
    WEST_VIRGINIA
    WISCONSIN
    WYOMING
}

enum USStateAbbreviated {
  AL
	AK
	AZ
	AR
	CA
	CO
	CT
	DE
	FL
	GA
	HI
	ID
	IL
	IN
	IA
	KS
	KY
	LA
	ME
	MD
	MA
	MI
	MN
	MS
	MO
	MT
	NE
	NV
	NH
	NJ
	NM
	NY
	NC
	ND
	OH
	OK
	OR
	PA
	RI
	SC
	SD
	TN
	TX
	UT
	VT
	VA
	WA
	WV
	WI
	WY
}

enum Country {
  United_States @map("United States")
  Canada
}

enum CountryCode {
  US
  CN
}

model User {
  id               String       @id @unique @default(cuid())
  firstName        String
  lastName         String
  username         String       @unique
  email            String       @unique
  emailVerified    Boolean      @default(false)
  isLegalAge       Boolean?
  isSignUpComplete Boolean      @default(false)
  termsAccepted    Boolean      @default(false)
  idVerified       Boolean      @default(false)
  scannedDOB       DateTime?
  idFrontImage     String?
  idBackImage      String?
  dialCode         String
  phone            String       @unique
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  accounts         Account[]
  driver           Driver?
  profilePicture   ImageUser?
  memberships      Membership[]
  orders           Order[]
  reviews          Review[]
  sessions         Session[]
  address          Address[]    @relation("AddressToUser")
  isSubscribedForWeedText Boolean @default(true)

  @@index([id])
  @@index([email])
  @@index([phone])
}

model Driver {
  id            String         @id @default(cuid())
  email         String         @unique
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  user          User           @relation(fields: [id], references: [id])
  licenseNumber String?
  vehicle       Vehicle[]
  driverSession DriverSession?
  orders        Order[]
  routes        Route[]

  @@index([id])
  @@index([email])
}

model Vehicle {
  id            String         @id @unique @default(cuid())
  make          String
  model         String
  year          Int
  licensePlateNumber String
  driverId      String
  driver        Driver         @relation(fields: [driverId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model DriverSession {
  id               String   @id @unique @default(cuid())
  isOnline         Boolean  @default(false)
  isActiveDelivery Boolean  @default(false)
  routeId          String?  @unique
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  driver           Driver   @relation(fields: [id], references: [id])

  @@index([id])
  @@index([routeId])
}

model Route {
  driverId String
  orderId  String @unique
  driver   Driver @relation(fields: [driverId], references: [id], onDelete: NoAction)
  order    Order  @relation(fields: [orderId], references: [id], onDelete: NoAction, onUpdate: Cascade)

  @@index([driverId])
  @@index([orderId])
}

model Vendor {
  id            String         @id @unique @default(cuid())
  name          String         @unique
  publicName    String         @unique
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  organizations Organization[]

  @@unique([id, name])
  @@index([id])
  @@index([name])
  @@index([publicName])
}

model Address {
  id           String        @id @unique @default(cuid())
  street1      String
  street2      String?
  city         String
  state        USStateAbbreviated? @default(MD)
  zipcode      Int
  country      Country      @default(United_States)
  countryCode  CountryCode? @default(US)
  coordinateId String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  coordinates  Coordinates?  @relation(fields: [coordinateId], references: [id], onDelete: Cascade, onUpdate: SetNull)
  orders       Order[]
  organization Organization?
  user         User[]        @relation("AddressToUser")

  @@index([id])
}

model ImageOrganization {
  id             String       @id @unique @default(cuid())
  location       String
  organizationId String
  blurhash       String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model ImageProduct {
  id        String         @id @unique @default(cuid())
  location  String
  variantId String
  blurhash  String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  variant   ProductVariant @relation("images", fields: [variantId], references: [id])

  @@index([variantId])
}

model ImageUser {
  id        String   @id @unique @default(cuid())
  location  String
  userId    String   @unique
  blurhash  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model ImageVendor {
  id        String   @id @unique @default(cuid())
  location  String
  blurhash  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([id])
}

model ImageArticle {
  id        String   @id @unique @default(cuid())
  location  String
  articleId String   @unique
  blurhash  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
}

model Coordinates {
  id        String    @id @unique @default(cuid())
  latitude  Float
  longitude Float
  radius    Float?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  addresses Address[]
}

model Membership {
  id             String         @id @unique @default(cuid())
  role           MembershipRole
  userId         String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  user           User?          @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  organizationId String
  organizations  Organization @relation("MembershipToOrganization", fields: [organizationId], references: [id], onUpdate: NoAction, onDelete: Cascade)

  // @@unique([id, organizationId])
  @@index([userId])
}

model Order {
  id                      String           @id @unique @default(cuid())
  type                    OrderType        @default(delivery)
  items                   ProductVariant[] @relation("OrderToProductVariant")
  isWeedTextOrder         Boolean          @default(false)

  subtotal                Int
  taxFactor               Float
  taxAmount               Int
  deliveryFee             Int              @default(0)
  mileageFee              Int              @default(0)
  platformFee             Int              @default(0)
  total                   Int

  distance                Float            @default(0)
  deliveryDeadline        DateTime

  orderStatus             OrderStatus      @default(Pending)
  customerId              String
  customer                User             @relation(fields: [customerId], references: [id], onDelete: NoAction)
  addressId               String
  destinationAddress      Address          @relation(fields: [addressId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  organization            Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  organizationId          String

  driver                  Driver?          @relation(fields: [driverId], references: [id])
  driverId                String?
  isDriverAssigned        Boolean          @default(false)
  driverAssignedAt        DateTime?

  isProductPickedUp       Boolean          @default(false)
  productPickedUpAt       DateTime?

  isDeliveredOrder        Boolean          @default(false)
  deliveredAt             DateTime?

  isCustomerReceivedOrder Boolean          @default(false)
  customerReceivedOrderAt DateTime?

  isCompleted             Boolean          @default(false)
  completedAt             DateTime?
  duration                Int?
  isDeliveredOnTime       Boolean?

  purchaseId              String?          @unique
  purchase                Purchase?
  routeId                 String?          @unique
  route                   Route?

  createdAt               DateTime         @default(now())
  updatedAt               DateTime         @updatedAt

  @@index([addressId])
  @@index([customerId])
  @@index([driverId])
  @@index([organizationId])
}

enum OrderType {
  delivery
  pickup
}

model Purchase {
  id            String        @id @unique @default(cuid())
  paymentStatus PaymentStatus @default(Pending)
  gateway       String        @default("stripe")
  type          String        @default("card")
  amount        Float
  token         String
  orderId       String        @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  order         Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
}

model Organization {
  id                       String              @id @unique @default(cuid())
  name                     String              @unique
  stripeAccountId          String?             @unique
  stripeOnboardingComplete Boolean             @default(false)
  addressId                String              @unique
  dialCode                 String
  phone                    String?
  termsAccepted            Boolean             @default(false)
  subdomainId              String
  createdAt                DateTime            @default(now())
  updatedAt                DateTime            @updatedAt
  showInMarketPlace        Boolean             @default(true)
  categoryList             CategoryList?
  images                   ImageOrganization[]
  orders                   Order[]
  address                  Address             @relation(fields: [addressId], references: [id], onDelete: Cascade)
  schedule                 Schedule[]
  subdomain                SubDomain           @relation(fields: [subdomainId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products                 Product[]
  productVariants          ProductVariant[]    @relation("variantOrganization")
  siteSetting              SiteSetting?
  memberships              Membership[]        @relation("MembershipToOrganization")
  subscribedForDelivery    Boolean             @default(true)
  subscribedForPickup      Boolean             @default(false)
  subscribedForWeedText    Boolean             @default(true)
  dailyDeals               DailyDeal[]

  vendor                   Vendor?             @relation(fields: [vendorId, vendorName], references: [id, name])
  vendorId                 String?
  vendorName               String?
  
  ecommerceUrl             String?
  pos                      POS                 @default(none)
  inventory                Inventory           @default(none)

  metrcLicenseNumber       String?
  metrcUserKey             String?
  dutchieKey               String?
  weedmapsKey              String?
  blazeKey                 String?

  @@index([id])
  @@index([name])
  @@index([vendorId])
  @@index([subdomainId])
  @@unique([id, name])
}

enum POS {
  none
  dutchie
  weedmaps
  blaze
}

enum Inventory {
  none
  dutchie
  weedmaps
  blaze
  metrc
  biotrack
}

model Schedule {
  id              String        @id @unique @default(cuid())
  days            Int?
  day             Day?          @default(Monday)
  openAt          Int           @default(900)
  closeAt         Int           @default(2000)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  organizationId  String?
  organization    Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([id])
  @@index([organizationId])
}

enum Day {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

model Product {
  id             String           @id @unique @default(cuid())
  name           String
  description    String?
  features       String?
  organizationId String
  rating         Float
  tags           String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  variants       ProductVariant[]
  reviews        Review?
  categories     Category[]       @relation("CategoryToProduct")

  @@index([id])
  @@index([organizationId])
}

model ProductVariant {
  id               String         @id @unique @default(cuid())
  name             String
  sku              String
  organizationId   String
  organizationName String
  organization   Organization     @relation("variantOrganization", fields: [organizationId, organizationName], references: [id, name], onDelete:  NoAction, onUpdate: Cascade)
  productId        String
  rating           Float
  unit             Unit           @default(g)
  size             Float
  quantity         Int
  basePrice        Int
  discount         Int
  isDiscount       Boolean        @default(false)
  salePrice        Int
  currency         CurrencyName   @default(USD)
  stock            Int
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  images           ImageProduct[] @relation("images")
  product          Product        @relation(fields: [productId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order            Order[]        @relation("OrderToProductVariant")
  dailyDeals       DailyDeal[]

  @@index([organizationId, organizationName])
  @@index([productId, organizationId])
  @@index([id])
  @@index([productId])
}

model Category {
  id            String              @id @unique @default(cuid())
  name          String
  slug          String
  icon          String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  categoryLists ProductCategories[]
  products      Product[]           @relation("CategoryToProduct")

  @@index([name])
}

model ProductCategories {
  categoryListId String
  categoryId     String
  category       Category     @relation(fields: [categoryId], references: [id])
  categoryList   CategoryList @relation(fields: [categoryListId], references: [id])

  @@id([categoryListId, categoryId])
  @@index([categoryListId])
  @@index([categoryId])
}

model CategoryList {
  id             String              @id @unique @default(cuid())
  organizationId String              @unique
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  organization   Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  categories     ProductCategories[]
}

model ServiceList {
  id        String    @id @unique @default(cuid())
  name      String
  slug      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  services  Service[] @relation("ServiceToServiceList")

  @@index([slug])
}

model Service {
  id           String        @id @unique @default(cuid())
  title        String
  subtitle     String?
  slug         String        @unique
  icon         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  serviceLists ServiceList[] @relation("ServiceToServiceList")

  @@index([title])
  @@index([slug])
}

model Review {
  id        String   @id @unique @default(cuid())
  rating    Float
  comment   String?
  productId String   @unique
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([productId])
}

model SiteSetting {
  id             String       @id @unique @default(cuid())
  title          String       @default("Your Shop Title")
  bannerText     String?      @default("Welcome")
  description    String?      @default("We've launched our shop on Gras! Browse our goods.")

  primaryColor    String?     @default("#14a33d")
  secondaryColor  String?     @default("#13622a")
  tertiaryColor   String?     @default("#fff2da")
  textColor       String?     @default("#a8a8a8")
  backgroundColor String?     @default("#ffffff")

  organizationId String       @unique
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([id])
}

model SubDomain {
  id           String         @id @unique @default(cuid())
  isValid      Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  organization Organization[]

  @@index([id])
}

model Article {
  id          String        @id @unique @default(cuid())
  name        String
  title       String
  description String
  href        String
  tag         ArticleTag?
  content     String
  author      String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  image       ImageArticle?

  @@index([id])
  @@index([title])
}

enum OrderStatus {
  Pending
  Processing
  ReadyForPickup
  ReadyForDelivery
  OnDelivery
  Delivered
  Cancelled
  Completed
}

enum PaymentStatus {
  Pending
  Paid
  Failed
}

enum MembershipRole {
  OWNER  @map("1")
  ADMIN  @map("2")
  MEMBER @map("3")
}

enum CurrencyName {
  USD
}

enum Unit {
  g
}

enum ArticleTag {
  dispensaries
  drivers
  events
  entertainment
  culture
  art
  sports
  science
  politics
  business
  health
  food
  gras
}

model FeaturesBackend {
  feature     FeatureBe     @unique
  enabled     Boolean       @default(false)
}

model FeaturesFrontend {
  feature     FeatureFe     @unique
  enabled     Boolean       @default(false)
}

enum FeatureBe {
  weed_text
}

enum FeatureFe {
  daily_deals_sms
  orders
  products
  users
  delivery_tracking
  storefront
  checkout_widget
}

model DailyDeal {
  title       String
  id          String        @id @unique @default(cuid())
  description String
  startTime   DateTime      @default(now())
  endTime     DateTime
  isExpired   Boolean       @default(false)
  products    ProductVariant[]
  total       Int
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model all_auth_recipe_users {
  app_id                                                                                      String                        @default("public") @db.VarChar(64)
  tenant_id                                                                                   String                        @default("public") @db.VarChar(64)
  user_id                                                                                     String                        @db.Char(36)
  primary_or_recipe_user_id                                                                   String                        @db.Char(36)
  is_linked_or_is_a_primary_user                                                              Boolean                       @default(false)
  recipe_id                                                                                   String                        @db.VarChar(128)
  time_joined                                                                                 BigInt
  primary_or_recipe_user_time_joined                                                          BigInt
  app_id_to_user_id_all_auth_recipe_users_app_id_primary_or_recipe_user_idToapp_id_to_user_id app_id_to_user_id             @relation("all_auth_recipe_users_app_id_primary_or_recipe_user_idToapp_id_to_user_id", fields: [app_id, primary_or_recipe_user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "all_auth_recipe_users_primary_or_recipe_user_id_fkey")
  tenants                                                                                     tenants                       @relation(fields: [app_id, tenant_id], references: [app_id, tenant_id], onDelete: Cascade, onUpdate: NoAction, map: "all_auth_recipe_users_tenant_id_fkey")
  app_id_to_user_id_all_auth_recipe_users_app_id_user_idToapp_id_to_user_id                   app_id_to_user_id             @relation("all_auth_recipe_users_app_id_user_idToapp_id_to_user_id", fields: [app_id, user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "all_auth_recipe_users_user_id_fkey")
  emailpassword_user_to_tenant                                                                emailpassword_user_to_tenant?
  passwordless_user_to_tenant                                                                 passwordless_user_to_tenant?
  thirdparty_user_to_tenant                                                                   thirdparty_user_to_tenant?

  @@id([app_id, tenant_id, user_id])
  @@index([app_id, tenant_id], map: "all_auth_recipe_tenant_id_index")
  @@index([app_id, user_id], map: "all_auth_recipe_user_id_index")
  @@index([app_id, tenant_id, primary_or_recipe_user_time_joined(sort: Desc), primary_or_recipe_user_id(sort: Desc)], map: "all_auth_recipe_users_pagination_index1")
  @@index([app_id, tenant_id, primary_or_recipe_user_time_joined, primary_or_recipe_user_id(sort: Desc)], map: "all_auth_recipe_users_pagination_index2")
  @@index([recipe_id, app_id, tenant_id, primary_or_recipe_user_time_joined(sort: Desc), primary_or_recipe_user_id(sort: Desc)], map: "all_auth_recipe_users_pagination_index3")
  @@index([recipe_id, app_id, tenant_id, primary_or_recipe_user_time_joined, primary_or_recipe_user_id(sort: Desc)], map: "all_auth_recipe_users_pagination_index4")
  @@index([primary_or_recipe_user_id, app_id], map: "all_auth_recipe_users_primary_user_id_index")
  @@index([app_id, recipe_id, tenant_id], map: "all_auth_recipe_users_recipe_id_index")
}

model app_id_to_user_id {
  app_id                                                                                          String                            @default("public") @db.VarChar(64)
  user_id                                                                                         String                            @db.Char(36)
  recipe_id                                                                                       String                            @db.VarChar(128)
  primary_or_recipe_user_id                                                                       String                            @db.Char(36)
  is_linked_or_is_a_primary_user                                                                  Boolean                           @default(false)
  all_auth_recipe_users_all_auth_recipe_users_app_id_primary_or_recipe_user_idToapp_id_to_user_id all_auth_recipe_users[]           @relation("all_auth_recipe_users_app_id_primary_or_recipe_user_idToapp_id_to_user_id")
  all_auth_recipe_users_all_auth_recipe_users_app_id_user_idToapp_id_to_user_id                   all_auth_recipe_users[]           @relation("all_auth_recipe_users_app_id_user_idToapp_id_to_user_id")
  apps                                                                                            apps                              @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)
  app_id_to_user_id                                                                               app_id_to_user_id                 @relation("app_id_to_user_idToapp_id_to_user_id", fields: [app_id, primary_or_recipe_user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "app_id_to_user_id_primary_or_recipe_user_id_fkey")
  other_app_id_to_user_id                                                                         app_id_to_user_id[]               @relation("app_id_to_user_idToapp_id_to_user_id")
  emailpassword_pswd_reset_tokens                                                                 emailpassword_pswd_reset_tokens[]
  emailpassword_users                                                                             emailpassword_users?
  passwordless_users                                                                              passwordless_users?
  thirdparty_users                                                                                thirdparty_users?
  userid_mapping                                                                                  userid_mapping?

  @@id([app_id, user_id])
  @@index([app_id], map: "app_id_to_user_id_app_id_index")
  @@index([primary_or_recipe_user_id, app_id], map: "app_id_to_user_id_primary_user_id_index")
}

model apps {
  app_id                            String                              @id @default("public") @db.VarChar(64)
  created_at_time                   BigInt?
  app_id_to_user_id                 app_id_to_user_id[]
  dashboard_users                   dashboard_users[]
  emailverification_verified_emails emailverification_verified_emails[]
  jwt_signing_keys                  jwt_signing_keys[]
  roles                             roles[]
  session_access_token_signing_keys session_access_token_signing_keys[]
  tenants                           tenants[]
  totp_users                        totp_users[]
  user_last_active                  user_last_active[]
  user_metadata                     user_metadata[]
}

model dashboard_user_sessions {
  app_id          String          @default("public") @db.VarChar(64)
  session_id      String          @db.Char(36)
  user_id         String          @db.Char(36)
  time_created    BigInt
  expiry          BigInt
  dashboard_users dashboard_users @relation(fields: [app_id, user_id], references: [app_id, user_id], onDelete: Cascade, map: "dashboard_user_sessions_user_id_fkey")

  @@id([app_id, session_id])
  @@index([expiry], map: "dashboard_user_sessions_expiry_index")
  @@index([app_id, user_id], map: "dashboard_user_sessions_user_id_index")
}

model dashboard_users {
  app_id                  String                    @default("public") @db.VarChar(64)
  user_id                 String                    @db.Char(36)
  email                   String                    @db.VarChar(256)
  password_hash           String                    @db.VarChar(256)
  time_joined             BigInt
  dashboard_user_sessions dashboard_user_sessions[]
  apps                    apps                      @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([app_id, user_id])
  @@unique([app_id, email], map: "dashboard_users_email_key")
  @@index([app_id], map: "dashboard_users_app_id_index")
}

model emailpassword_pswd_reset_tokens {
  app_id            String            @default("public") @db.VarChar(64)
  user_id           String            @db.Char(36)
  token             String            @unique @db.VarChar(128)
  email             String?           @db.VarChar(256)
  token_expiry      BigInt
  app_id_to_user_id app_id_to_user_id @relation(fields: [app_id, user_id], references: [app_id, user_id], onDelete: Cascade, map: "emailpassword_pswd_reset_tokens_user_id_fkey")

  @@id([app_id, user_id, token])
  @@index([token_expiry], map: "emailpassword_password_reset_token_expiry_index")
  @@index([app_id, user_id], map: "emailpassword_pswd_reset_tokens_user_id_index")
}

model emailpassword_user_to_tenant {
  app_id                String                @default("public") @db.VarChar(64)
  tenant_id             String                @default("public") @db.VarChar(64)
  user_id               String                @db.Char(36)
  email                 String                @db.VarChar(256)
  all_auth_recipe_users all_auth_recipe_users @relation(fields: [app_id, tenant_id, user_id], references: [app_id, tenant_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "emailpassword_user_to_tenant_user_id_fkey")

  @@id([app_id, tenant_id, user_id])
  @@unique([app_id, tenant_id, email], map: "emailpassword_user_to_tenant_email_key")
}

model emailpassword_users {
  app_id            String            @default("public") @db.VarChar(64)
  user_id           String            @db.Char(36)
  email             String            @db.VarChar(256)
  password_hash     String            @db.VarChar(256)
  time_joined       BigInt
  app_id_to_user_id app_id_to_user_id @relation(fields: [app_id, user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "emailpassword_users_user_id_fkey")

  @@id([app_id, user_id])
}

model emailverification_tokens {
  app_id       String  @default("public") @db.VarChar(64)
  tenant_id    String  @default("public") @db.VarChar(64)
  user_id      String  @db.VarChar(128)
  email        String  @db.VarChar(256)
  token        String  @unique @db.VarChar(128)
  token_expiry BigInt
  tenants      tenants @relation(fields: [app_id, tenant_id], references: [app_id, tenant_id], onDelete: Cascade, onUpdate: NoAction, map: "emailverification_tokens_tenant_id_fkey")

  @@id([app_id, tenant_id, user_id, email, token])
  @@index([token_expiry], map: "emailverification_tokens_index")
  @@index([app_id, tenant_id], map: "emailverification_tokens_tenant_id_index")
}

model emailverification_verified_emails {
  app_id  String @default("public") @db.VarChar(64)
  user_id String @db.VarChar(128)
  email   String @db.VarChar(256)
  apps    apps   @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([app_id, user_id, email])
  @@index([app_id], map: "emailverification_verified_emails_app_id_index")
}

model jwt_signing_keys {
  app_id     String  @default("public") @db.VarChar(64)
  key_id     String  @db.VarChar(255)
  key_string String
  algorithm  String  @db.VarChar(10)
  created_at BigInt?
  apps       apps    @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([app_id, key_id])
  @@index([app_id], map: "jwt_signing_keys_app_id_index")
}

model key_value {
  app_id          String  @default("public") @db.VarChar(64)
  tenant_id       String  @default("public") @db.VarChar(64)
  name            String  @db.VarChar(128)
  value           String?
  created_at_time BigInt?
  tenants         tenants @relation(fields: [app_id, tenant_id], references: [app_id, tenant_id], onDelete: Cascade, onUpdate: NoAction, map: "key_value_tenant_id_fkey")

  @@id([app_id, tenant_id, name])
  @@index([app_id, tenant_id], map: "key_value_tenant_id_index")
}

model passwordless_codes {
  app_id               String               @default("public") @db.VarChar(64)
  tenant_id            String               @default("public") @db.VarChar(64)
  code_id              String               @db.Char(36)
  device_id_hash       String               @db.Char(44)
  link_code_hash       String               @db.Char(44)
  created_at           BigInt
  passwordless_devices passwordless_devices @relation(fields: [app_id, tenant_id, device_id_hash], references: [app_id, tenant_id, device_id_hash], onDelete: Cascade, map: "passwordless_codes_device_id_hash_fkey")

  @@id([app_id, tenant_id, code_id])
  @@unique([app_id, tenant_id, link_code_hash], map: "passwordless_codes_link_code_hash_key")
  @@index([app_id, tenant_id, created_at], map: "passwordless_codes_created_at_index")
  @@index([app_id, tenant_id, device_id_hash], map: "passwordless_codes_device_id_hash_index")
}

model passwordless_devices {
  app_id             String               @default("public") @db.VarChar(64)
  tenant_id          String               @default("public") @db.VarChar(64)
  device_id_hash     String               @db.Char(44)
  email              String?              @db.VarChar(256)
  phone_number       String?              @db.VarChar(256)
  link_code_salt     String               @db.Char(44)
  failed_attempts    Int
  passwordless_codes passwordless_codes[]
  tenants            tenants              @relation(fields: [app_id, tenant_id], references: [app_id, tenant_id], onDelete: Cascade, onUpdate: NoAction, map: "passwordless_devices_tenant_id_fkey")

  @@id([app_id, tenant_id, device_id_hash])
  @@index([app_id, tenant_id, email], map: "passwordless_devices_email_index")
  @@index([app_id, tenant_id, phone_number], map: "passwordless_devices_phone_number_index")
  @@index([app_id, tenant_id], map: "passwordless_devices_tenant_id_index")
}

model passwordless_user_to_tenant {
  app_id                String                @default("public") @db.VarChar(64)
  tenant_id             String                @default("public") @db.VarChar(64)
  user_id               String                @db.Char(36)
  email                 String?               @db.VarChar(256)
  phone_number          String?               @db.VarChar(256)
  all_auth_recipe_users all_auth_recipe_users @relation(fields: [app_id, tenant_id, user_id], references: [app_id, tenant_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "passwordless_user_to_tenant_user_id_fkey")

  @@id([app_id, tenant_id, user_id])
  @@unique([app_id, tenant_id, email], map: "passwordless_user_to_tenant_email_key")
  @@unique([app_id, tenant_id, phone_number], map: "passwordless_user_to_tenant_phone_number_key")
}

model passwordless_users {
  app_id            String            @default("public") @db.VarChar(64)
  user_id           String            @db.Char(36)
  email             String?           @db.VarChar(256)
  phone_number      String?           @db.VarChar(256)
  time_joined       BigInt
  app_id_to_user_id app_id_to_user_id @relation(fields: [app_id, user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "passwordless_users_user_id_fkey")

  @@id([app_id, user_id])
}

model role_permissions {
  app_id     String @default("public") @db.VarChar(64)
  role       String @db.VarChar(255)
  permission String @db.VarChar(255)
  roles      roles  @relation(fields: [app_id, role], references: [app_id, role], onDelete: Cascade, onUpdate: NoAction, map: "role_permissions_role_fkey")

  @@id([app_id, role, permission])
  @@index([app_id, permission], map: "role_permissions_permission_index")
  @@index([app_id, role], map: "role_permissions_role_index")
}

model roles {
  app_id           String             @default("public") @db.VarChar(64)
  role             String             @db.VarChar(255)
  role_permissions role_permissions[]
  apps             apps               @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)
  user_roles       user_roles[]

  @@id([app_id, role])
  @@index([app_id], map: "roles_app_id_index")
}

model session_access_token_signing_keys {
  app_id          String  @default("public") @db.VarChar(64)
  created_at_time BigInt
  value           String?
  apps            apps    @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([app_id, created_at_time])
  @@index([app_id], map: "access_token_signing_keys_app_id_index")
}

model session_info {
  app_id               String  @default("public") @db.VarChar(64)
  tenant_id            String  @default("public") @db.VarChar(64)
  session_handle       String  @db.VarChar(255)
  user_id              String  @db.VarChar(128)
  refresh_token_hash_2 String  @db.VarChar(128)
  session_data         String?
  expires_at           BigInt
  created_at_time      BigInt
  jwt_user_payload     String?
  use_static_key       Boolean
  tenants              tenants @relation(fields: [app_id, tenant_id], references: [app_id, tenant_id], onDelete: Cascade, onUpdate: NoAction, map: "session_info_tenant_id_fkey")

  @@id([app_id, tenant_id, session_handle])
  @@index([expires_at], map: "session_expiry_index")
  @@index([app_id, tenant_id], map: "session_info_tenant_id_index")
}

model tenant_configs {
  connection_uri_domain       String                        @default("") @db.VarChar(256)
  app_id                      String                        @default("public") @db.VarChar(64)
  tenant_id                   String                        @default("public") @db.VarChar(64)
  core_config                 String?
  email_password_enabled      Boolean?
  passwordless_enabled        Boolean?
  third_party_enabled         Boolean?
  tenant_thirdparty_providers tenant_thirdparty_providers[]

  @@id([connection_uri_domain, app_id, tenant_id])
}

model tenant_thirdparty_provider_clients {
  connection_uri_domain       String                      @default("") @db.VarChar(256)
  app_id                      String                      @default("public") @db.VarChar(64)
  tenant_id                   String                      @default("public") @db.VarChar(64)
  third_party_id              String                      @db.VarChar(28)
  client_type                 String                      @default("") @db.VarChar(64)
  client_id                   String                      @db.VarChar(256)
  client_secret               String?
  scope                       String[]                    @db.VarChar(128)
  force_pkce                  Boolean?
  additional_config           String?
  tenant_thirdparty_providers tenant_thirdparty_providers @relation(fields: [connection_uri_domain, app_id, tenant_id, third_party_id], references: [connection_uri_domain, app_id, tenant_id, third_party_id], onDelete: Cascade, onUpdate: NoAction, map: "tenant_thirdparty_provider_clients_third_party_id_fkey")

  @@id([connection_uri_domain, app_id, tenant_id, third_party_id, client_type])
  @@index([connection_uri_domain, app_id, tenant_id, third_party_id], map: "tenant_thirdparty_provider_clients_third_party_id_index")
}

model tenant_thirdparty_providers {
  connection_uri_domain                                String                               @default("") @db.VarChar(256)
  app_id                                               String                               @default("public") @db.VarChar(64)
  tenant_id                                            String                               @default("public") @db.VarChar(64)
  third_party_id                                       String                               @db.VarChar(28)
  name                                                 String?                              @db.VarChar(64)
  authorization_endpoint                               String?
  authorization_endpoint_query_params                  String?
  token_endpoint                                       String?
  token_endpoint_body_params                           String?
  user_info_endpoint                                   String?
  user_info_endpoint_query_params                      String?
  user_info_endpoint_headers                           String?
  jwks_uri                                             String?
  oidc_discovery_endpoint                              String?
  require_email                                        Boolean?
  user_info_map_from_id_token_payload_user_id          String?                              @db.VarChar(64)
  user_info_map_from_id_token_payload_email            String?                              @db.VarChar(64)
  user_info_map_from_id_token_payload_email_verified   String?                              @db.VarChar(64)
  user_info_map_from_user_info_endpoint_user_id        String?                              @db.VarChar(64)
  user_info_map_from_user_info_endpoint_email          String?                              @db.VarChar(64)
  user_info_map_from_user_info_endpoint_email_verified String?                              @db.VarChar(64)
  tenant_thirdparty_provider_clients                   tenant_thirdparty_provider_clients[]
  tenant_configs                                       tenant_configs                       @relation(fields: [connection_uri_domain, app_id, tenant_id], references: [connection_uri_domain, app_id, tenant_id], onDelete: Cascade, onUpdate: NoAction, map: "tenant_thirdparty_providers_tenant_id_fkey")

  @@id([connection_uri_domain, app_id, tenant_id, third_party_id])
  @@index([connection_uri_domain, app_id, tenant_id], map: "tenant_thirdparty_providers_tenant_id_index")
}

model tenants {
  app_id                   String                     @default("public") @db.VarChar(64)
  tenant_id                String                     @default("public") @db.VarChar(64)
  created_at_time          BigInt?
  all_auth_recipe_users    all_auth_recipe_users[]
  emailverification_tokens emailverification_tokens[]
  key_value                key_value[]
  passwordless_devices     passwordless_devices[]
  session_info             session_info[]
  apps                     apps                       @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)
  totp_used_codes          totp_used_codes[]
  user_roles               user_roles[]

  @@id([app_id, tenant_id])
  @@index([app_id], map: "tenants_app_id_index")
}

model thirdparty_user_to_tenant {
  app_id                String                @default("public") @db.VarChar(64)
  tenant_id             String                @default("public") @db.VarChar(64)
  user_id               String                @db.Char(36)
  third_party_id        String                @db.VarChar(28)
  third_party_user_id   String                @db.VarChar(256)
  all_auth_recipe_users all_auth_recipe_users @relation(fields: [app_id, tenant_id, user_id], references: [app_id, tenant_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "thirdparty_user_to_tenant_user_id_fkey")

  @@id([app_id, tenant_id, user_id])
  @@unique([app_id, tenant_id, third_party_id, third_party_user_id], map: "thirdparty_user_to_tenant_third_party_user_id_key")
}

model thirdparty_users {
  app_id              String            @default("public") @db.VarChar(64)
  third_party_id      String            @db.VarChar(28)
  third_party_user_id String            @db.VarChar(256)
  user_id             String            @db.Char(36)
  email               String            @db.VarChar(256)
  time_joined         BigInt
  app_id_to_user_id   app_id_to_user_id @relation(fields: [app_id, user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "thirdparty_users_user_id_fkey")

  @@id([app_id, user_id])
  @@index([app_id, email], map: "thirdparty_users_email_index")
  @@index([app_id, third_party_id, third_party_user_id], map: "thirdparty_users_thirdparty_user_id_index")
}

model totp_used_codes {
  app_id          String     @default("public") @db.VarChar(64)
  tenant_id       String     @default("public") @db.VarChar(64)
  user_id         String     @db.VarChar(128)
  code            String     @db.VarChar(8)
  is_valid        Boolean
  expiry_time_ms  BigInt
  created_time_ms BigInt
  tenants         tenants    @relation(fields: [app_id, tenant_id], references: [app_id, tenant_id], onDelete: Cascade, onUpdate: NoAction, map: "totp_used_codes_tenant_id_fkey")
  totp_users      totp_users @relation(fields: [app_id, user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "totp_used_codes_user_id_fkey")

  @@id([app_id, tenant_id, user_id, created_time_ms])
  @@index([app_id, tenant_id, expiry_time_ms], map: "totp_used_codes_expiry_time_ms_index")
  @@index([app_id, tenant_id], map: "totp_used_codes_tenant_id_index")
  @@index([app_id, user_id], map: "totp_used_codes_user_id_index")
}

model totp_user_devices {
  app_id      String     @default("public") @db.VarChar(64)
  user_id     String     @db.VarChar(128)
  device_name String     @db.VarChar(256)
  secret_key  String     @db.VarChar(256)
  period      Int
  skew        Int
  verified    Boolean
  totp_users  totp_users @relation(fields: [app_id, user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "totp_user_devices_user_id_fkey")

  @@id([app_id, user_id, device_name])
  @@index([app_id, user_id], map: "totp_user_devices_user_id_index")
}

model totp_users {
  app_id            String              @default("public") @db.VarChar(64)
  user_id           String              @db.VarChar(128)
  totp_used_codes   totp_used_codes[]
  totp_user_devices totp_user_devices[]
  apps              apps                @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([app_id, user_id])
  @@index([app_id], map: "totp_users_app_id_index")
}

model user_last_active {
  app_id           String  @default("public") @db.VarChar(64)
  user_id          String  @db.VarChar(128)
  last_active_time BigInt?
  apps             apps    @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([app_id, user_id])
  @@index([app_id], map: "user_last_active_app_id_index")
}

model user_metadata {
  app_id        String @default("public") @db.VarChar(64)
  user_id       String @db.VarChar(128)
  user_metadata String
  apps          apps   @relation(fields: [app_id], references: [app_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([app_id, user_id])
  @@index([app_id], map: "user_metadata_app_id_index")
}

model user_roles {
  app_id    String  @default("public") @db.VarChar(64)
  tenant_id String  @default("public") @db.VarChar(64)
  user_id   String  @db.VarChar(128)
  role      String  @db.VarChar(255)
  roles     roles   @relation(fields: [app_id, role], references: [app_id, role], onDelete: Cascade, onUpdate: NoAction, map: "user_roles_role_fkey")
  tenants   tenants @relation(fields: [app_id, tenant_id], references: [app_id, tenant_id], onDelete: Cascade, onUpdate: NoAction, map: "user_roles_tenant_id_fkey")

  @@id([app_id, tenant_id, user_id, role])
  @@index([app_id, role], map: "user_roles_app_id_role_index")
  @@index([app_id, tenant_id, role], map: "user_roles_role_index")
  @@index([app_id, tenant_id], map: "user_roles_tenant_id_index")
}

model userid_mapping {
  app_id                String            @default("public") @db.VarChar(64)
  supertokens_user_id   String            @db.Char(36)
  external_user_id      String            @db.VarChar(128)
  external_user_id_info String?
  app_id_to_user_id     app_id_to_user_id @relation(fields: [app_id, supertokens_user_id], references: [app_id, user_id], onDelete: Cascade, onUpdate: NoAction, map: "userid_mapping_supertokens_user_id_fkey")

  @@id([app_id, supertokens_user_id, external_user_id])
  @@unique([app_id, external_user_id], map: "userid_mapping_external_user_id_key")
  @@unique([app_id, supertokens_user_id], map: "userid_mapping_supertokens_user_id_key")
  @@index([app_id, supertokens_user_id], map: "userid_mapping_supertokens_user_id_index")
}
